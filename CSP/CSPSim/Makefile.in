SUBDIRS = Source Tools/Terrain/dem2dat Tools/Terrain/tile

export DEMETER_RELATIVE = ../Demeter
export CHUNKLOD_RELATIVE = ../CSPChunkLod
export SIMDATA_RELATIVE = ../SimData

export GDEBUGF = -g -Wall
export GCFLAGS = -fPIC -O2# -DSWIG_GLOBAL
export GLDOPTS = -shared -ldl @SWIG_SWIGPY@
export GSWOPTS = -c++ -python -noexcept @SWIG_NORUNTIME@
export CXX = g++
export SWIG = swig 

.PHONY: all clean clean-deps swig default

default: all

all clean clean-deps: Makefile
	@for dir in $(SUBDIRS); do \
		$(MAKE) -C $${dir} $@ || exit 1; \
	done
	@$(MAKE) InputMaps


Makefile: Makefile.in configure.in acinclude.m4
	aclocal ; autoconf
	./configure


InputMaps: aircraft.hid gamescreen.hid


%.hid:
	@test -e Data/Input/$@ || \
	  ( cd Tools/HID && \
	    python cspinput Examples/$(@:%.hid=%.map) ../../Data/Input/$@ && \
	    echo "Default input map created for $@; see Tools/HID/README for details." \
	  )
	@test -e Data/Input/$@ || \
	    echo "Unable to create default input map for $@; see Tools/HID/README for details."


