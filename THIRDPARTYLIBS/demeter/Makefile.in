# Makefile for Demeter
# Clement Bourdarias <phneutre@icculus.org>
# last changed on Sunday, November 17th.

# Adapted for use with autoconf, December 6, 2002.
# Mark Rose <mrose@stm.lbl.gov>

SHELL = /bin/sh
VPATH = @srcdir@

subdirs = @subdirs@
top_srcdir = @top_srcdir@
srcdir = @srcdir@
prefix = @prefix@
exec_prefix = @exec_prefix@
bindir = $(exec_prefix)/bin
infodir = $(prefix)/info
libdir = $(prefix)/lib/gnudl
mandir = $(prefix)/man/man1

CC = @CC@
CXX = @CXX@
CPPFLAGS = @CPPFLAGS@ -I.
CFLAGS = $(CPPFLAGS) @CFLAGS@
CXXFLAGS = $(CPPFLAGS) @CXXFLAGS@
LDFLAGS = @LDFLAGS@
LIBS = @LIBS@
INSTALL = @INSTALL@
AR = @AR@
RANLIB = @RANLIB@


# nothing should be edited below this line

CODE_BINARY=demeter_csp.a
SHARED_LIB=libdemeter_csp.so

CXXFLAGS+=-Wall 
CXXFLAGS+=@sdl_FLAGS@
CXXFLAGS+=-D_USE_GDAL_
CXXFLAGS+=-w

%.o: %.cpp
	$(CXX) -fPIC -c -o $@ $< $(CXXFLAGS)

CODE_SOURCES = ./DemeterDrawable.cpp \
	./Terrain.cpp \
	./TerrainTextureFactory.cpp

CODE_OBJECTS=$(CODE_SOURCES:.cpp=.o)

all: $(CODE_BINARY)

$(CODE_BINARY): $(CODE_OBJECTS)
	rm -rf $(CODE_BINARY)
	$(AR) rc $(CODE_BINARY) $(CODE_OBJECTS)
	rm -rf $(SHARED_LIB)
	$(CC) -shared $(CODE_OBJECTS) -o $(SHARED_LIB)

clean:
	/bin/rm -f $(CODE_BINARY) $(CODE_OBJECTS) $(SHARED_LIB)

distclean:
	/bin/rm -f Makefile config.h config.status config.cache config.log
	
install:
	# soon.



# automatic re-running of configure if the ocnfigure.in file has changed
${srcdir}/configure: configure.in #aclocal.m4
	cd ${srcdir} && autoconf

# autoheader might not change config.h.in, so touch a stamp file
${srcdir}/config.h.in: stamp-h.in
${srcdir}/stamp-h.in: configure.in #aclocal.m4
	cd ${srcdir} && autoheader
	echo timestamp > ${srcdir}/stamp-h.in

config.h: stamp-h
stamp-h: config.h.in config.status
	./config.status
Makefile: Makefile.in config.status
	./config.status
config.status: configure
	./config.status --recheck
